<div class="contenedor-usuarios">
  <div class="cabecera">
    <h2 class="titulo">Listado de Empleados</h2>

    <div class="buscador">
      <input
        type="text"
        [(ngModel)]="terminoBusqueda"
        (keyup.enter)="ejecutarBusqueda()"
        placeholder="Buscar por nombre o documento..."
        class="buscador__input"
      />

      <button
        type="button"
        class="boton-accion buscador__boton"
        (click)="ejecutarBusqueda()"
      >
        Buscar
      </button>
    </div>
  </div>

  <br />

  <div *ngIf="cargando" class="cargando">
    Cargando empleados...
  </div>

  <div *ngIf="!cargando && errorCarga" class="mensaje-error">
    Ocurrió un error al cargar los empleados.
    <button type="button" (click)="cargarEmpleados(1)">Reintentar</button>
  </div>

  <ng-container *ngIf="!cargando && !errorCarga">
    <table
      *ngIf="empleados.length > 0; else sinEmpleados"
      class="tabla-usuarios"
    >
      <thead>
        <tr>
          <th>Nombre completo</th>
          <th>Documento</th>
          <th>Tipo</th>
          <th>Rol</th>
          <th>Sede</th>
          <th>Área</th>
          <th>Estado</th>
          <th>Cumpleaños</th>
          <th>Código escaneable</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let e of empleados" style="cursor: pointer;">
          <td>
            <a
              [routerLink]="['/panel/empleados', e.id]"
              style="display: block; color: inherit; text-decoration: none;"
            >
              {{ e.nombre }} {{ e.apellido_paterno }} {{ e.apellido_materno }}
            </a>
          </td>
          <td>{{ e.numero_documento }}</td>
          <td>{{ e.tipo_documento }}</td>
          <td>{{ e.rol }}</td>
          <td>{{ e.sede || '-' }}</td>
          <td>{{ e.area || '-' }}</td>
          <td>
            <span
              class="estado"
              [class.activo]="e.activo"
              [class.inactivo]="!e.activo"
            >
              {{ e.activo ? 'Activo' : 'Inactivo' }}
            </span>
          </td>

          <!-- ✅ NUEVO: Cumpleaños -->
          <td>
            <ng-container *ngIf="badgeCumple(e.fecha_nacimiento) as b; else sinCumple">
              <span class="bday-badge"  [ngClass]="b.cls">
                {{ b.text }}
              </span>
            </ng-container>
            <ng-template #sinCumple>
              <span class="bday-vacio">-</span>
            </ng-template>
          </td>

          <td>{{ e.code_scannable }}</td>

          <td class="acciones">
            <button
              class="btn-accion btn-editar"
              [routerLink]="['/panel/empleados', e.id, 'horario']"
            >
              Editar horario
            </button>

            <button
              class="btn-accion btn-descargar"
              (click)="descargarHorario(e)"
              [disabled]="descargandoId === e.id"
            >
              {{ descargandoId === e.id ? 'Generando...' : 'Descargar horario' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="paginacion" *ngIf="empleados.length > 0">
      <div class="paginacion__left">
        <div class="paginacion__info">
          Mostrando registros del
          {{ (paginaActual - 1) * tamanoPagina + 1 }}
          al
          {{
            (paginaActual * tamanoPagina) > totalRegistros
              ? totalRegistros
              : (paginaActual * tamanoPagina)
          }}
          de un total de {{ totalRegistros }} registros
        </div>

        <label>
          Mostrar
          <select
            [ngModel]="tamanoPagina"
            (ngModelChange)="cambiarTamanoPagina($event)"
          >
            <option *ngFor="let op of opcionesTamanoPagina" [ngValue]="op">
              {{ op }}
            </option>
          </select>
          registros
        </label>
      </div>

      <div class="paginacion__right">
        <button
          type="button"
          class="boton-estado"
          (click)="paginaAnterior()"
          [disabled]="paginaActual === 1"
        >
          «
        </button>

        <span class="paginacion__pagina">
          Página {{ paginaActual }} de {{ totalPaginas }}
        </span>

        <button
          type="button"
          class="boton-estado"
          (click)="paginaSiguiente()"
          [disabled]="paginaActual === totalPaginas"
        >
          »
        </button>
      </div>
    </div>

    <ng-template #sinEmpleados>
      <div class="sin-registros">
        No hay empleados que coincidan con la búsqueda.
      </div>
    </ng-template>
  </ng-container>
</div>
