<div class="reporte">
  <h2 class="titulo">Reporte de asistencias (Resumen)</h2>
  <p class="descripcion">
    Genera un resumen por empleado: tardanzas, minutos tarde, ausencias justificadas/injustificadas y ranking.
  </p>

  <div class="filtros">
    <div class="fila">
      <label>
        <input type="radio" name="modo" [(ngModel)]="modo" value="periodo" />
        Por periodo
      </label>
      <label>
        <input type="radio" name="modo" [(ngModel)]="modo" value="rango" />
        Por rango
      </label>
    </div>

    <div class="fila" *ngIf="modo === 'periodo'">
      <div class="campo">
        <span>Periodo</span>
        <select [(ngModel)]="period">
          <option value="semana">Semana</option>
          <option value="quincena">Quincena</option>
          <option value="mes">Mes</option>
          <option value="bimestre">Bimestre</option>
          <option value="trimestre">Trimestre</option>
          <option value="semestre">Semestre</option>
          <option value="anual">Anual</option>
        </select>
      </div>

      <div class="campo">
        <span>Referencia</span>
        <input type="date" [(ngModel)]="ref" />
      </div>
    </div>

    <div class="fila" *ngIf="modo === 'rango'">
      <div class="campo">
        <span>Desde</span>
        <input type="date" [(ngModel)]="desde" />
      </div>
      <div class="campo">
        <span>Hasta</span>
        <input type="date" [(ngModel)]="hasta" />
      </div>
    </div>

    <div class="fila">
      <!-- Usuario: buscador -->
      <div class="campo campo-buscador">
        <span>Usuario (opcional)</span>

        <div class="input-wrap">
          <input
            type="text"
            [(ngModel)]="usuarioQuery"
            (input)="onUsuarioInput()"
            placeholder="Buscar por DNI o nombre..."
            autocomplete="off"
          />
          <button *ngIf="usuarioQuery" type="button" class="clear" (click)="limpiarUsuario()">Ã—</button>
        </div>

        <div class="sugerencias" *ngIf="usuariosSugeridos.length > 0">
          <button
            type="button"
            class="sugerencia"
            *ngFor="let u of usuariosSugeridos"
            (click)="seleccionarUsuario(u)"
          >
            <div class="s1">{{ u.nombreCompleto }}</div>
            <div class="s2" *ngIf="u.numero_documento">DNI: {{ u.numero_documento }}</div>
          </button>
        </div>

        <div class="seleccion" *ngIf="usuarioSeleccionado">
          Seleccionado:
          <b>{{ usuarioSeleccionado.nombreCompleto }}</b>
          <span *ngIf="usuarioSeleccionado.numero_documento"> - {{ usuarioSeleccionado.numero_documento }}</span>
        </div>
      </div>

      <!-- Sede: dropdown -->
      <div class="campo">
        <span>Sede (opcional)</span>
        <select [(ngModel)]="sedeId" (ngModelChange)="onSedeChange($event)">
          <option value="">Todas las sedes</option>
          <option *ngFor="let s of sedes" [value]="s.id">{{ s.nombre }}</option>
        </select>
      </div>
    </div>
  </div>

  <div class="acciones">
    <button class="btn" (click)="descargarExcel()" [disabled]="descargando">
      {{ descargando ? 'Generando...' : 'Descargar Excel' }}
    </button>

    <button class="btn btn-sec" (click)="descargarPdf()" [disabled]="descargando">
      {{ descargando ? 'Generando...' : 'Descargar PDF' }}
    </button>
  </div>
</div>
